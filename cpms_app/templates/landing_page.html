{% extends 'home.html' %}
{% block title %}Home{% endblock %}
{% block content %}
    <!-- Breadcrumb Navigation -->
    <div class=" bg-light ">
        <nav aria-label="breadcrumb">
            <ol class="breadcrumb">
                <li class="breadcrumb-item"><a class="text-decoration-none" href="{% url 'home' %}">Home</a></li>        
            </ol>
        </nav>
    </div>

    <div class="container mt-2">
        <div class="jumbotron text-center  ">
                
                <div class="d-flex justify-content-end">
                    <button type="button" class="btn btn-outline-primary mx-2" data-bs-toggle="modal" data-bs-target="#projectsModal">
                        View Projects
                    </button>
                <button type="button" class="btn btn-outline-primary mx-2" data-bs-toggle="modal" data-bs-target="#teamsModal">
                        View Teams
                    </button>
                    <button type="button" class="btn btn-outline-primary mx-2" data-bs-toggle="modal" data-bs-target="#milestonesModal">
                        View Tasks
                    </button>
                </div>
        </div>
        <!-- Projects and Tasks  tab section -->
        <div class="row">
            <!-- Sidebar with tabs -->
            <div class="col-md-2">
                <div class="nav flex-column nav-pills" id="sideTabs" role="tablist" aria-orientation="vertical">
                    <a class="nav-link active" id="projects-tab" data-bs-toggle="pill" href="#projects" role="tab" aria-controls="projects" aria-selected="true">
                        Projects
                    </a>
                    <a class="nav-link" id="milestones-tab" data-bs-toggle="pill" href="#milestones" role="tab" aria-controls="milestones" aria-selected="false">
                        Tasks
                    </a>
                </div>
            </div>
            <!-- Tab content area -->
            <div class="col-md-10">
                <div class="tab-content" id="sideTabsContent">
                    <!-- Projects Section -->
                    <div class="tab-pane fade show active" id="projects" role="tabpanel" aria-labelledby="projects-tab">         
                        <!-- Tab navigation for project categories -->
                        <ul class="nav nav-pills mb-4" id="projectTabs" role="tablist">
                            <li class="nav-item" role="presentation">
                                <a class="nav-link active" id="pending-projects-tab" data-bs-toggle="pill" href="#pending-projects" role="tab" aria-controls="pending-projects" aria-selected="true">
                                    Pending
                                </a>
                            </li>
                            <li class="nav-item" role="presentation">
                                <a class="nav-link" id="ongoing-projects-tab" data-bs-toggle="pill" href="#ongoing-projects" role="tab" aria-controls="ongoing-projects" aria-selected="false">
                                    Ongoing
                                </a>
                            </li>
                            <li class="nav-item" role="presentation">
                                <a class="nav-link" id="completed-projects-tab" data-bs-toggle="pill" href="#completed-projects" role="tab" aria-controls="completed-projects" aria-selected="false">
                                    Completed
                                </a>
                            </li>
                        </ul>

                        <!-- Tab content area for project categories -->
                        <div class="tab-content" id="projectTabsContent">
                            <!-- Pending Projects Tab -->
                            <div class="tab-pane fade show active" id="pending-projects" role="tabpanel" aria-labelledby="pending-projects-tab">
                                <div class="row mb-4">
                                    <div class="col-md-12">
                                        <div class="card shadow-sm">
                                            <div class="card-body">
                                                
                                                <ul id="pendingProjectList" class="list-group">
                                                    {% for project in pending_projects %}
                                                        <li class="list-group-item d-flex justify-content-between align-items-center">
                                                            <div>
                                                                <strong>{{ project.name }}</strong><br>
                                                            </div>
                                                        </li>
                                                    {% empty %}
                                                        <li class="list-group-item text-center">No pending projects.</li>
                                                    {% endfor %}
                                                </ul>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Ongoing Projects Tab -->
                            <div class="tab-pane fade" id="ongoing-projects" role="tabpanel" aria-labelledby="ongoing-projects-tab">
                                <div class="row mb-4">
                                    <div class="col-md-12">
                                        <div class="card shadow-sm">
                                            <div class="card-body">
                                                
                                                <ul id="ongoingProjectList" class="list-group">
                                                    {% for project in ongoing_projects %}
                                                        <li class="list-group-item d-flex justify-content-between align-items-center">
                                                            <div>
                                                                <strong>{{ project.name }}</strong><br>
                                                            </div>
                                                        </li>
                                                    {% empty %}
                                                        <li class="list-group-item text-center">No ongoing projects.</li>
                                                    {% endfor %}
                                                </ul>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Completed Projects Tab -->
                            <div class="tab-pane fade" id="completed-projects" role="tabpanel" aria-labelledby="completed-projects-tab">
                                <div class="row mb-4">
                                    <div class="col-md-12">
                                        <div class="card shadow-sm">
                                            <div class="card-body">
                                                
                                                <ul id="completedProjectList" class="list-group">
                                                    {% for project in completed_projects %}
                                                        <li class="list-group-item d-flex justify-content-between align-items-center">
                                                            <div>
                                                                <strong>{{ project.name }}</strong><br>
                                                            </div>
                                                        </li>
                                                    {% empty %}
                                                        <li class="list-group-item text-center">No completed projects.</li>
                                                    {% endfor %}
                                                </ul>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>                
                    </div>

                    <!-- Tasks Section -->
                    <div class="tab-pane fade" id="milestones" role="tabpanel" aria-labelledby="milestones-tab">
                        <!-- Tab navigation for milestones categories -->
                        <ul class="nav nav-pills mb-4" id="taskTabs" role="tablist">
                            <li class="nav-item" role="presentation">
                                <a class="nav-link active" id="pending-milestones-tab" data-bs-toggle="pill" href="#pending-milestones" role="tab" aria-controls="pending-milestones" aria-selected="true">
                                    Pending
                                </a>
                            </li>
                            <li class="nav-item" role="presentation">
                                <a class="nav-link" id="ongoing-milestones-tab" data-bs-toggle="pill" href="#ongoing-milestones" role="tab" aria-controls="ongoing-milestones" aria-selected="false">
                                    Ongoing
                                </a>
                            </li>
                            <li class="nav-item" role="presentation">
                                <a class="nav-link" id="completed-milestones-tab" data-bs-toggle="pill" href="#completed-milestones" role="tab" aria-controls="completed-milestones" aria-selected="false">
                                    Completed
                                </a>
                            </li>
                        </ul>
                        <!-- Tab content area for project categories -->
                        <div class="tab-content" id="projectTabsContent">
                            <!-- Pending milestones Tab -->
                            <div class="tab-pane fade show active" id="pending-milestones" role="tabpanel" aria-labelledby="pending-milestones-tab">
                                <div class="row mb-4">
                                    <div class="col-md-12">
                                        <div class="card shadow-sm">
                                            <div class="card-body">
                                               
                                                <ul id="pendingTaskList" class="list-group">
                                                    {% for task in pending_milestones %}
                                                        <li class="list-group-item d-flex justify-content-between align-items-center">
                                                            <div>
                                                                <strong>{{ task.name }}</strong><br>
                                                            </div>
                                                           
                                                        </li>
                                                    {% empty %}
                                                        <li class="list-group-item text-center">No pending projects.</li>
                                                    {% endfor %}
                                                </ul>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Ongoing milestones Tab -->
                            <div class="tab-pane fade" id="ongoing-milestones" role="tabpanel" aria-labelledby="ongoing-milestones-tab">
                                <div class="row mb-4">
                                    <div class="col-md-12">
                                        <div class="card shadow-sm">
                                            <div class="card-body">
                                                
                                                <ul id="ongoingTaskList" class="list-group">
                                                    {% for task in ongoing_milestones %}
                                                        <li class="list-group-item d-flex justify-content-between align-items-center">
                                                             <div>
                                                                <strong>{{ task.name }}</strong><br>
                                                            </div>
                                                            <div class="col-md-4 mt-2">
                                                                <div class="d-flex justify-content-end align-items-end">
                                                                    <a href="{% url 'task_updates' 3 task.id %}" class="btn btn-outline-secondary btn-sm">
                                                                        <i class="bi bi-clock-history"></i> Daily Update
                                                                    </a>
                                                                </div>
                                                            </div>
                                                        </li>
                                                    {% empty %}
                                                        <li class="list-group-item text-center">No ongoing milestones.</li>
                                                    {% endfor %}
                                                </ul>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Completed Projects Tab -->
                            <div class="tab-pane fade" id="completed-milestones" role="tabpanel" aria-labelledby="completed-milestones-tab">
                                <div class="row mb-4">
                                    <div class="col-md-12">
                                        <div class="card shadow-sm">
                                            <div class="card-body">
                                                
                                                <ul id="completedTaskList" class="list-group">
                                                    {% for task in completed_milestones %}
                                                        <li class="list-group-item d-flex justify-content-between align-items-center">
                                                            <div>
                                                                <strong>{{ task.name }}</strong><br>
                                                            </div>
                                                            
                                                        </li>
                                                    {% empty %}
                                                        <li class="list-group-item text-center">No completed Tasks.</li>
                                                    {% endfor %}
                                                </ul>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>   
                    </div>
                </div>

                <!--  Recent Tasks -->
                <div class="col-md-12">
                    <div class="card shadow-sm">
                        <div class="card-body">
                            <h3>Recents</h3>
                            <div class="accordion" id="milestonesAccordion">
                                {% for task in recent_milestones %}
                                    <div class="accordion-item">
                                        <h2 class="accordion-header" id="heading{{ forloop.counter }}">
                                            <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse"
                                                    data-bs-target="#collapse{{ forloop.counter }}" aria-expanded="false"
                                                    aria-controls="collapse{{ forloop.counter }}">
                                                {{ task.name }}
                                            </button>
                                        </h2>
                                        <div id="collapse{{ forloop.counter }}" class="accordion-collapse collapse"
                                                aria-labelledby="heading{{ forloop.counter }}" data-bs-parent="#milestonesAccordion">
                                            <div class="accordion-body">
                                                From Project: <em>{{ task.project.name }}</em><br>
                                                {% if task.updates.exists %}
                                                    {{ task.updates.first.created_at|date:"M d, Y" }}<br>
                                                    <strong>Progress Detail:</strong> {{ task.updates.first.progress_detail }}<br>
                                                    {% if task.updates.first.issues %}
                                                        <strong>Issues:</strong> {{ task.updates.first.issues }}
                                                    {% endif %}
                                                {% else %}
                                                    <p>No updates available for this task.</p>
                                                {% endif %}
                                                
                                                <br>
                                                
                                            </div>
                                        </div>
                                    </div>
                                {% empty %}
                                    <div class="text-center">No recent milestones found.</div>
                                {% endfor %}
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Projects Modal -->
        <div class="modal fade" id="projectsModal" tabindex="-1" aria-labelledby="projectsModalLabel" aria-hidden="true">
            <div class="modal-dialog modal-lg">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" id="projectsModalLabel">All Projects You Have Participated In</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body">
                        <!-- Search Input -->
                        <input id="projectSearch" type="text" class="form-control mb-3" placeholder="Search projects..." onkeyup="filterProjects()">
                        
                        <!-- Accordion for Projects -->
                        <div class="accordion" id="projectsAccordion">
                            {% for project in projects %}
                                <div class="accordion-item">
                                    <h2 class="accordion-header" id="heading{{ forloop.counter }}">
                                        <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" 
                                                data-bs-target="#collapse{{ forloop.counter }}" aria-expanded="false" 
                                                aria-controls="collapse{{ forloop.counter }}">
                                            {{ project.name }}
                                        </button>
                                    </h2>
                                    <div id="collapse{{ forloop.counter }}" class="accordion-collapse collapse" 
                                        aria-labelledby="heading{{ forloop.counter }}" data-bs-parent="#projectsAccordion">
                                        <div class="accordion-body">
                                            <strong>Status:</strong> 
                                            <span class="badge bg-info">{{ project.get_status_display }}</span><br>
                                            <strong>Progress:</strong> {{ project.calculate_progress }}%<br>
                                            <strong>Start Date:</strong> {{ project.start_date|date:"M d, Y" }}<br>
                                            <strong>End Date:</strong> 
                                            {% if project.end_date %}
                                                {{ project.end_date|date:"M d, Y" }}
                                            {% else %}
                                                <span class="text-muted">Ongoing</span>
                                            {% endif %}<br>
                                            <strong>Team:</strong> {{ project.assigned_team }}<br>
                                            <strong>Description:</strong> 
                                            <span>{{ project.description|default:"No description provided." }}</span>
                                        </div>
                                    </div>
                                </div>
                            {% empty %}
                                <div class="text-center">You have not participated in any projects yet.</div>
                            {% endfor %}
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Tasks Modal -->
        <div class="modal fade" id="milestonesModal" tabindex="-1" aria-labelledby="milestonesModalLabel" aria-hidden="true">
            <div class="modal-dialog modal-lg">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" id="milestonesModalLabel">Recent Tasks</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body">
                        <!-- Search Input -->
                        <input id="taskSearch" type="text" class="form-control mb-3" placeholder="Search milestones..." onkeyup="filterTasks()">

                        <!-- Accordion for Tasks -->
                        <div class="accordion" id="milestonesAccordion">
                            {% for task in milestones %}
                                <div class="accordion-item">
                                    <h2 class="accordion-header" id="taskHeading{{ forloop.counter }}">
                                        <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" 
                                                data-bs-target="#taskCollapse{{ forloop.counter }}" aria-expanded="false" 
                                                aria-controls="taskCollapse{{ forloop.counter }}">
                                            {{ task.name }}
                                        </button>
                                    </h2>
                                    <div id="taskCollapse{{ forloop.counter }}" class="accordion-collapse collapse" 
                                        aria-labelledby="taskHeading{{ forloop.counter }}" data-bs-parent="#milestonesAccordion">
                                        <div class="accordion-body">
                                            <strong>From Project:</strong> <em>{{ task.project.name }}</em><br>
                                            <strong>Last Updated:</strong> {{ task.updates.first.created_at|date:"M d, Y" }}<br>
                                            <strong>Status:</strong> 
                                            <span class="badge {% if task.status == 'completed' %}bg-success{% elif task.status == 'in_progress' %}bg-warning{% else %}bg-secondary{% endif %}">
                                                {{ task.get_status_display }}
                                            </span><br>
                                            <strong>Task Description:</strong>
                                            <p>{{ task.description|default:"No description available." }}</p>
                                            <strong>Deadline:</strong> {{ task.enddate|date:"M d, Y" }}<br>
                                        </div>
                                    </div>
                                </div>
                            {% empty %}
                                <div class="text-center">No recent milestones found.</div>
                            {% endfor %}
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Teams Modal -->
        <div class="modal fade" id="teamsModal" tabindex="-1" aria-labelledby="teamsModalLabel" aria-hidden="true">
            <div class="modal-dialog modal-lg">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" id="teamsModalLabel">All Teams You Are In</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body">
                        <!-- Search Input -->
                        <input id="teamSearch" type="text" class="form-control mb-3" placeholder="Search teams..." onkeyup="filterTeams()">

                        <!-- Accordion for Teams -->
                        <div class="accordion" id="teamsAccordion">
                            {% for team in teams %}
                                <div class="accordion-item">
                                    <h2 class="accordion-header" id="teamHeading{{ forloop.counter }}">
                                        <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" 
                                                data-bs-target="#teamCollapse{{ forloop.counter }}" aria-expanded="false" 
                                                aria-controls="teamCollapse{{ forloop.counter }}">
                                            {{ team.name }}
                                        </button>
                                    </h2>
                                    <div id="teamCollapse{{ forloop.counter }}" class="accordion-collapse collapse" 
                                        aria-labelledby="teamHeading{{ forloop.counter }}" data-bs-parent="#teamsAccordion">
                                        <div class="accordion-body">
                                            <strong>Team Lead:</strong> {{ team.leader }}<br>
                                            <strong>Members:</strong> 
                                            <ul>
                                                {% for member in team.members.all %}
                                                    <li>{{ member.username }}</li>
                                                {% endfor %}
                                            </ul>
                                            <strong>Created On:</strong> {{ team.created_at|date:"M d, Y" }}<br>
                                            <strong>Description:</strong>
                                            <p>{{ team.description|default:"No description available." }}</p>
                                        </div>
                                    </div>
                                </div>
                            {% empty %}
                                <div class="text-center">You are not part of any teams yet.</div>
                            {% endfor %}
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                    </div>
                </div>
            </div>
        </div>  

    </div>

    <script>


        function filterTeams() {
            const searchInput = document.getElementById('teamSearch').value.toLowerCase();
            const teamItems = document.querySelectorAll('#teamsAccordion .accordion-item');

            teamItems.forEach(item => {
                const teamName = item.querySelector('.accordion-button').textContent.toLowerCase();
                if (teamName.includes(searchInput)) {
                    item.style.display = '';
                } else {
                    item.style.display = 'none';
                }
            });
        }

            // Filter Projects
        function filterProjects() {
            const searchInput = document.getElementById('projectSearch').value.toLowerCase();
            const projectItems = document.querySelectorAll('#projectsAccordion .accordion-item');

            projectItems.forEach(item => {
                const projectName = item.querySelector('.accordion-button').textContent.toLowerCase();
                if (projectName.includes(searchInput)) {
                    item.style.display = '';
                } else {
                    item.style.display = 'none';
                }
            });
        }
        function filterTasks() {
            const searchInput = document.getElementById('taskSearch').value.toLowerCase();
            const taskItems = document.querySelectorAll('#milestonesAccordion .accordion-item');

            taskItems.forEach(item => {
                const taskName = item.querySelector('.accordion-button').textContent.toLowerCase();
                if (taskName.includes(searchInput)) {
                    item.style.display = '';
                } else {
                    item.style.display = 'none';
                }
            });
        }
            // Hover effect for cards
            document.querySelectorAll('.card-hover').forEach(card => {
                card.addEventListener('mouseenter', () => card.classList.add('shadow-lg'));
                card.addEventListener('mouseleave', () => card.classList.remove('shadow-lg'));
            });
    </script>

    <style>
        .card-hover {
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }

        .card-hover:hover {
            transform: translateY(-5px);
        }

        .progress-bar {
            transition: width 0.6s ease;
        }
    </style>
{% endblock %}
