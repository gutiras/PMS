{% extends 'home.html' %}
{% block title %}Home{% endblock %}
{% block content %}
<!-- Breadcrumb Navigation -->
<div class=" bg-light ">
    <nav aria-label="breadcrumb">
        <ol class="breadcrumb">
            <li class="breadcrumb-item"><a class="text-decoration-none" href="{% url 'home' %}">Home</a></li>        
        </ol>
    </nav>
</div>
<div class="container mt-2">
    <div class="jumbotron text-center  ">
            
            <div class="d-flex justify-content-end">
                <button type="button" class="btn btn-outline-primary mx-2" data-bs-toggle="modal" data-bs-target="#projectsModal">
                    View Projects
                </button>
               <button type="button" class="btn btn-outline-primary mx-2" data-bs-toggle="modal" data-bs-target="#teamsModal">
                    View Teams
                </button>
                <button type="button" class="btn btn-outline-primary mx-2" data-bs-toggle="modal" data-bs-target="#tasksModal">
                    View Tasks
                </button>
            </div>
    </div>
    <!-- Summary Statistics -->
    <div class="row text-center mt-2 just">
        <!-- Current Projects Section -->
        <div class="col-md-6">
            <div class="card shadow-sm card-hover">
                <div class="card-body">
                <div class="d-flex justify-content-between align-items-center mb-3">

                        <h4 class="card-title text-primary">Total Projects Participated </h4>
                    <p class="fs-2 fw-bold">{{ total_projects }}</p>
                    </div>
                    
                    <hr>
                    <div class="d-flex justify-content-between">
                        <span class="fw-semibold text-muted">Ongoing:</span> <span class="text-success fw-bold">{{ user_projects }}</span>
                    </div>
                    <div class="d-flex justify-content-between">
                        <span class="fw-semibold text-muted">Completed:</span> <span class="text-info fw-bold">{{ completed_projects }}</span>
                    </div>
                    <div class="d-flex justify-content-between">
                        <span class="fw-semibold text-muted">Pending:</span> <span class="text-warning fw-bold">{{ pending_projectss }}</span>
                    </div>
                </div>
            </div>
        </div>
    
        <!-- Current Tasks Section -->
        <div class="col-md-6">
            <div class="card shadow-sm card-hover">
                <div class="card-body">
                    <div class="d-flex justify-content-between align-items-center mb-3">
                    <h4 class="card-title text-primary">Total Tasks Assigned</h4>
                    <p class="fs-2 fw-bold">{{ total_tasks }}</p>
                    </div>
                    <hr>

                    <div class="d-flex justify-content-between">
                        <span class="fw-semibold text-muted">Ongoing:</span> <span class="text-success fw-bold">{{ ongoing_tasks }}</span>
                    </div>
                    <div class="d-flex justify-content-between">
                        <span class="fw-semibold text-muted">Completed:</span> <span class="text-info fw-bold">{{ completed_tasks }}</span>
                    </div>
                    <div class="d-flex justify-content-between">
                        <span class="fw-semibold text-muted">Pending:</span> <span class="text-warning fw-bold">{{ pending_tasks }}</span>
                    </div>
                </div>
            </div>
        </div>
        
    </div>

    <!-- Projects Modal -->
    <div class="modal fade" id="projectsModal" tabindex="-1" aria-labelledby="projectsModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="projectsModalLabel">All Projects You Have Participated In</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <!-- Search Input -->
                    <input id="projectSearch" type="text" class="form-control mb-3" placeholder="Search projects..." onkeyup="filterProjects()">
                    
                    <!-- Accordion for Projects -->
                    <div class="accordion" id="projectsAccordion">
                        {% for project in projects %}
                            <div class="accordion-item">
                                <h2 class="accordion-header" id="heading{{ forloop.counter }}">
                                    <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" 
                                            data-bs-target="#collapse{{ forloop.counter }}" aria-expanded="false" 
                                            aria-controls="collapse{{ forloop.counter }}">
                                        {{ project.name }}
                                    </button>
                                </h2>
                                <div id="collapse{{ forloop.counter }}" class="accordion-collapse collapse" 
                                    aria-labelledby="heading{{ forloop.counter }}" data-bs-parent="#projectsAccordion">
                                    <div class="accordion-body">
                                        <strong>Status:</strong> 
                                        <span class="badge bg-info">{{ project.get_status_display }}</span><br>
                                        <strong>Progress:</strong> {{ project.calculate_progress }}%<br>
                                        <strong>Start Date:</strong> {{ project.start_date|date:"M d, Y" }}<br>
                                        <strong>End Date:</strong> 
                                        {% if project.end_date %}
                                            {{ project.end_date|date:"M d, Y" }}
                                        {% else %}
                                            <span class="text-muted">Ongoing</span>
                                        {% endif %}<br>
                                        <strong>Team:</strong> {{ project.assigned_team }}<br>
                                        <strong>Description:</strong> 
                                        <span>{{ project.description|default:"No description provided." }}</span>
                                    </div>
                                </div>
                            </div>
                        {% empty %}
                            <div class="text-center">You have not participated in any projects yet.</div>
                        {% endfor %}
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                </div>
            </div>
        </div>
    </div>


    <!-- Tasks Modal -->
    <div class="modal fade" id="tasksModal" tabindex="-1" aria-labelledby="tasksModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="tasksModalLabel">Recent Tasks</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <!-- Search Input -->
                    <input id="taskSearch" type="text" class="form-control mb-3" placeholder="Search tasks..." onkeyup="filterTasks()">

                    <!-- Accordion for Tasks -->
                    <div class="accordion" id="tasksAccordion">
                        {% for task in tasks %}
                            <div class="accordion-item">
                                <h2 class="accordion-header" id="taskHeading{{ forloop.counter }}">
                                    <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" 
                                            data-bs-target="#taskCollapse{{ forloop.counter }}" aria-expanded="false" 
                                            aria-controls="taskCollapse{{ forloop.counter }}">
                                        {{ task.name }}
                                    </button>
                                </h2>
                                <div id="taskCollapse{{ forloop.counter }}" class="accordion-collapse collapse" 
                                    aria-labelledby="taskHeading{{ forloop.counter }}" data-bs-parent="#tasksAccordion">
                                    <div class="accordion-body">
                                        <strong>From Project:</strong> <em>{{ task.project.name }}</em><br>
                                        <strong>Last Updated:</strong> {{ task.updates.first.created_at|date:"M d, Y" }}<br>
                                        <strong>Status:</strong> 
                                        <span class="badge {% if task.status == 'completed' %}bg-success{% elif task.status == 'in_progress' %}bg-warning{% else %}bg-secondary{% endif %}">
                                            {{ task.get_status_display }}
                                        </span><br>
                                        <strong>Task Description:</strong>
                                        <p>{{ task.description|default:"No description available." }}</p>
                                        <strong>Deadline:</strong> {{ task.enddate|date:"M d, Y" }}<br>
                                    </div>
                                </div>
                            </div>
                        {% empty %}
                            <div class="text-center">No recent tasks found.</div>
                        {% endfor %}
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                </div>
            </div>
        </div>
    </div>


     <!-- Teams Modal -->
    <div class="modal fade" id="teamsModal" tabindex="-1" aria-labelledby="teamsModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="teamsModalLabel">All Teams You Are In</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <!-- Search Input -->
                    <input id="teamSearch" type="text" class="form-control mb-3" placeholder="Search teams..." onkeyup="filterTeams()">

                    <!-- Accordion for Teams -->
                    <div class="accordion" id="teamsAccordion">
                        {% for team in teams %}
                            <div class="accordion-item">
                                <h2 class="accordion-header" id="teamHeading{{ forloop.counter }}">
                                    <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" 
                                            data-bs-target="#teamCollapse{{ forloop.counter }}" aria-expanded="false" 
                                            aria-controls="teamCollapse{{ forloop.counter }}">
                                        {{ team.name }}
                                    </button>
                                </h2>
                                <div id="teamCollapse{{ forloop.counter }}" class="accordion-collapse collapse" 
                                    aria-labelledby="teamHeading{{ forloop.counter }}" data-bs-parent="#teamsAccordion">
                                    <div class="accordion-body">
                                        <strong>Team Lead:</strong> {{ team.leader }}<br>
                                        <strong>Members:</strong> 
                                        <ul>
                                            {% for member in team.members.all %}
                                                <li>{{ member.username }}</li>
                                            {% endfor %}
                                        </ul>
                                        <strong>Created On:</strong> {{ team.created_at|date:"M d, Y" }}<br>
                                        <strong>Description:</strong>
                                        <p>{{ team.description|default:"No description available." }}</p>
                                    </div>
                                </div>
                            </div>
                        {% empty %}
                            <div class="text-center">You are not part of any teams yet.</div>
                        {% endfor %}
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                </div>
            </div>
        </div>
    </div>


    <!-- Ongoing Projects and Recent Tasks -->
    <div class="row mt-5">
        <div class="col-md-6">
            <div class="card shadow-sm">
                <div class="card-body">
                    <h3>Pending and Ongoing Projects</h3>
                    <ul id="projectList" class="list-group">
                        {% for project in ongoing_pending_projects %}
                            <li class="list-group-item d-flex justify-content-between align-items-center">
                                <div>
                                    <strong>{{ project.name }}</strong>
                                    <br>
                                    Status: <span class="badge bg-info">{{ project.get_status_display }}</span>
                                </div>
                                <div class="progress w-50">
                                    <div class="progress-bar progress-bar-striped progress-bar-animated" role="progressbar" 
                                            style="width: {{ project.progress }}%;" 
                                            aria-valuenow="{{ project.progress }}" 
                                            aria-valuemin="0" 
                                            aria-valuemax="100">
                                        {{ project.calculate_progress }}%
                                    </div>
                                </div>
                            </li>
                        {% empty %}
                            <li class="list-group-item text-center">No ongoing projects.</li>
                        {% endfor %}
                    </ul>
                </div>
            </div>
        </div>
        <div class="col-md-6">
            <div class="card shadow-sm">
                <div class="card-body">
                    <h3>Recent Tasks</h3>
                    <div class="accordion" id="tasksAccordion">
                        {% for task in recent_tasks %}
                            <div class="accordion-item">
                                <h2 class="accordion-header" id="heading{{ forloop.counter }}">
                                    <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse"
                                            data-bs-target="#collapse{{ forloop.counter }}" aria-expanded="false"
                                            aria-controls="collapse{{ forloop.counter }}">
                                        {{ task.name }}
                                    </button>
                                </h2>
                                <div id="collapse{{ forloop.counter }}" class="accordion-collapse collapse"
                                        aria-labelledby="heading{{ forloop.counter }}" data-bs-parent="#tasksAccordion">
                                    <div class="accordion-body">
                                        From Project: <em>{{ task.project.name }}</em><br>
                                        Last Updated: {{ task.updates.first.created_at|date:"M d, Y" }}<br>
                                        Status: <span class="badge {% if task.status == 'completed' %}bg-success{% elif task.status == 'in_progress' %}bg-warning{% else %}bg-secondary{% endif %}">
                                            {{ task.get_status_display }}
                                        </span>
                                    </div>
                                </div>
                            </div>
                        {% empty %}
                            <div class="text-center">No recent tasks found.</div>
                        {% endfor %}
                    </div>
                </div>
            </div>
        </div>
    </div>

</div>

<script>


    function filterTeams() {
        const searchInput = document.getElementById('teamSearch').value.toLowerCase();
        const teamItems = document.querySelectorAll('#teamsAccordion .accordion-item');

        teamItems.forEach(item => {
            const teamName = item.querySelector('.accordion-button').textContent.toLowerCase();
            if (teamName.includes(searchInput)) {
                item.style.display = '';
            } else {
                item.style.display = 'none';
            }
        });
    }

        // Filter Projects
    function filterProjects() {
        const searchInput = document.getElementById('projectSearch').value.toLowerCase();
        const projectItems = document.querySelectorAll('#projectsAccordion .accordion-item');

        projectItems.forEach(item => {
            const projectName = item.querySelector('.accordion-button').textContent.toLowerCase();
            if (projectName.includes(searchInput)) {
                item.style.display = '';
            } else {
                item.style.display = 'none';
            }
        });
    }
    function filterTasks() {
        const searchInput = document.getElementById('taskSearch').value.toLowerCase();
        const taskItems = document.querySelectorAll('#tasksAccordion .accordion-item');

        taskItems.forEach(item => {
            const taskName = item.querySelector('.accordion-button').textContent.toLowerCase();
            if (taskName.includes(searchInput)) {
                item.style.display = '';
            } else {
                item.style.display = 'none';
            }
        });
    }
        // Hover effect for cards
        document.querySelectorAll('.card-hover').forEach(card => {
            card.addEventListener('mouseenter', () => card.classList.add('shadow-lg'));
            card.addEventListener('mouseleave', () => card.classList.remove('shadow-lg'));
        });
</script>

<style>
    .card-hover {
        transition: transform 0.3s ease, box-shadow 0.3s ease;
    }

    .card-hover:hover {
        transform: translateY(-5px);
    }

    .progress-bar {
        transition: width 0.6s ease;
    }
</style>
{% endblock %}
